<!doctype html>
<html lang="ru">

<head>
	<meta charset="utf-8">
	<title>CSS Object Model</title>
	<meta name="description" content="Introduction in CSS Object Model API">
	<meta name="keywords" content="css, cssom, dom, api, js, document">
	<meta name="author" content="Pavel Karpovich">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../../css/bundle.min.css">
	
	<link rel="stylesheet" href="../../css/custom.css" />
	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match( /print-pdf/gi ) ? "../../css/print/pdf.css" : "../../css/print/paper.css";
		document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>

	<!--[if lt IE 9]>
		<script src="../../js/html5shiv.min.js"></script>
	<![endif]-->
</head>

<body>
	<script src="../../js/theme.js"></script>
	<div class="reveal">
		<div class="slides">
			<section>
                <section>
                    <h1>Веб программирование. Фронтенд</h1>
                    <h3>CSSOM</h3>
					<div>
						<p style="display: inline-block;">
							Карпович Павел / 
						</p>
						<a href="https://github.com/tgjmjgj" class="icon-button github">
							<i class="fa fa-github"></i><span></span>
						</a>
						<a href="https://facebook.com/paradox7master" class="icon-button facebook">
							<i class="fa fa-facebook"></i><span></span>
						</a>
					</div>
                </section>
				<section>
					<h2>Содержание лекции</h2>
					<nav id="presentable-toc" class="table-content"></nav>
				</section>
			</section>
            
            <section>
                <section>
                    <h1>CSSOM</h1>
                    <p></p>
                    <small>Да, есть такое название</small>
                </section>
                <section>
                    <h2>CSSOM</h2>
                    <p>
                        До этого момента мы рассматривали DOM API, - набор функций, который позволяет программно
                        взаимодействовать с HTML документом.
                    </p>
                    <p>
                        Мы не касались стилей, даже когда работали с классами. CSS классы уже были
                        созданы заранее, а мы лишь подключали/отключали их от HTML элементов. Т.е.
                        просто работали с атрибутом class, а атрибуты это часть DOM.
                    </p>
                    <p>
                        CSSOM же позволяет изменять именно <u>стили</u>.
                    </p>
                </section>
                <section>
                    <h2>CSSOM</h2>
                    <blockquote>
                        <span class="purple">CSS Object Model</span> (CSSOM) - это API, набор функций
                        и объектов, которые позволяют взаимодействовать с CSS через JavaScript. 
                    </blockquote>
                    <p>
                        Это то же, что и DOM, только для CSS, а не для HTML.
                    </p>
                    <p>
                        С помощью CSSOM можно получать и динамически изменять стили, программно
                        создавать наборы стилей и CSS классы.
                    </p>
                </section>
            </section>
            <section>
                <section>
                    <h2>Встроенные стили</h2>
                    <p>
                        Самый главный и удобный способ взаимодействия с CSS свойствами - через
                        свойство <span class="blue">style</span>, которое есть у всех HTML элементов
                        (объект <i>HTMLElement</i>).
                    </p>
                    <p>
                        Например:
                    </p>
                    <pre>
                        <code class="js">
document.body.style.background = "lightblue";

let div = document.getElementsByTagName("div");
console.log(div.style.height);
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Свойство style</h2>
                    <p>
                        Через это JS свойство можно получать значение и изменять <u>любое</u> CSS свойство, у любого
                        элемента на странице.
                    </p>
                    <p>
                        Вот по такому формату:
                    </p>
                    <pre>
                        <code class="js">
element.style.propertyName
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Объект style</h2>
                    <p>
                        Свойство <span class="blue">style</span> содержит в себе объект <span class="blue">CSSStyleDeclaration</span>
                        (или <span class="blue">CSS2Properties</span>, в зависимости от браузера).
                    </p>
                    <p>
                        Это просто объект, в котором есть ключи для большинства свойств, существующих в CSS.
                    </p>
                    <p>
                        Если заглянуть в него, то можно будет увидеть этот огромный перечень свойств.
                    </p>
                </section>
                <section>
                    <h2>Правила наименования</h2>
                    <p>
                        Имена многих свойств записаны в объекте <span class="blue">style</span> так же, как и в CSS.
                    </p>
                    <p>
                        Но в некоторых именах в CSS встречаются знаки тире "-", а в JS этот символ нельзя использовать для 
                        названий переменных, поэтому при переносе свойств в JS знаки тире пропадают, и вместо них следующая
                        буква прописывается заглавной.
                    </p>
                    <p>
                        Трансляция имён происходит по такому принципу:
                    </p>
                    <table>
                        <tr>
                            <th><span class="blue">CSS</span></th>
                            <th><span class="purple">JS</span></th>
                        </tr>
                        <tr>
                            <td><span class="blue">background-color</span></td>
                            <td><span class="purple">backgroundColor</span></td>
                        </tr>
                        <tr>
                            <td><span class="blue">border-radius</span></td>
                            <td><span class="purple">borderRadius</span></td>
                        </tr>
                        <tr>
                            <td><span class="blue">box-sizing</span></td>
                            <td><span class="purple">boxSizing</span></td>
                        </tr>
                        <tr>
                            <td><span class="blue">grid-row-gap</span></td>
                            <td><span class="purple">grdidRowGap</span></td>
                        </tr>
                        <tr>
                            <td><span class="blue">min-width</span></td>
                            <td><span class="purple">minWidth</span></td>
                        </tr>
                    </table>
                </section>
                <section>
                    <h2>Альтернативная запись</h2>
                    <p>
                        Также к отдельным свойствам внутри объекта <span class="blue">style</span> можно обращаться и
                        через нотацию квадратных скобок.
                    </p>
                    <pre>
                        <code class="js">
let div1 = document.getElementById("test_div");
div1.style["width"] = "256px";
                        </code>
                    </pre>
                    <p>
                        Причём в это случае можно использовать не транслированные имена без знаков тире, а оригинальные
                        названия свойств из CSS:
                    </p>
                    <pre>
                        <code class="js">
div1.style["background-color"] = "#123456";
div1.style["margin-top"] = "2vw";
div1.style["text-align"] = "center";
                        </code>
                    </pre>
                </section>
                <section>
                    <h3>Пример с inline стилями</h3>
                    <style>
                        .cp_embed_wrapper > iframe[id="cp_embed_PgwqgK"] {
                            height: 500px;
                        }
                    </style>
                    <p class="codepen" data-height="265" data-theme-id="0" data-default-tab="html,result" data-user="ParadoxMaster" data-slug-hash="PgwqgK" data-preview="true" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="Using the style property to change the background color">
                        <span>See the Pen <a href="https://codepen.io/ParadoxMaster/pen/PgwqgK/">
                        Using the style property to change the background color</a> by Pavel (<a href="https://codepen.io/ParadoxMaster">@ParadoxMaster</a>)
                        on <a href="https://codepen.io">CodePen</a>.</span>
                    </p>
                    <script async src="https://static.codepen.io/assets/embed/ei.js"></script>
                </section>
                <section>
                    <h3>Ещё один</h3>
                    <style>
                        .cp_embed_wrapper > iframe[id="cp_embed_NmbQar"] {
                            height: 500px;
                        }
                    </style>
                    <p class="codepen" data-height="265" data-theme-id="0" data-default-tab="js,result" data-user="ParadoxMaster" data-slug-hash="NmbQar" data-preview="true" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="Random colors flow">
                        <span>See the Pen <a href="https://codepen.io/ParadoxMaster/pen/NmbQar/">
                        Random colors flow</a> by Pavel (<a href="https://codepen.io/ParadoxMaster">@ParadoxMaster</a>)
                        on <a href="https://codepen.io">CodePen</a>.</span>
                    </p>
                    <script async src="https://static.codepen.io/assets/embed/ei.js"></script>
                </section>
            </section>
            <section>
                <section>
                    <h2>Объект CSSStyleDeclaration</h2>
                    <p>
                        Свойство <span class="blue">style</span> хранит объект <span class="blue">CSSStyleDeclaration</span>.
                    </p>
                    <p>
                        Этот объект будет встречаться не только в этом свойстве, но и в нескольких других местах далее -
                        везде, где нужно хранить полный перечень CSS свойств элемента.
                    </p>
                    <p>
                        В нём есть парочка дополнительных методов:
                    </p>
                    <ul>
                        <li><span class="blue">setProperty()</span> - установка значения CSS свойства</li>
                        <li><span class="blue">getPropertyPriority()</span> - получение приоритета свойства</li>
                        <li><span class="blue">removeProperty()</span> - удаление значения CSS свойства</li>
                    </ul>
                    <p>
                        И свойство <span class="blue">cssText</span> - строка, которая хранится в атрибуте <i>style</i>
                        элемента.
                    </p>
                </section>
                <section>
                    <h2>Метод setProperty</h2>
                    <p>
                        Метод <span class="blue">setProperty()</span> является функциональной альтернативой для
                        задания значения CSS свойству.
                    </p>
                    <p>
                        Он принимает 2 обязательных строковых аргумента: название свойства и значение.
                    </p>
                    <pre>
                        <code class="js">
style.setProperty("property-name", "value");
                        </code>
                    </pre>
                    <p>
                        Например, вот так:
                    </p>
                    <pre>
                        <code class="js">
let span = document.getElementById("my_id");
span.style.setProperty("height", "300px");
span.style.setProperty("line-height", "300px");
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Работа с приоритетом</h2>
                    <p>
                        С помощью третьего дополнительного параметра метода <span class="blue">setProperty</span>
                        можно установить приоритетность свойства:
                    </p>
                    <p>
                        Допускается 2 варианта значения: "important" и "".
                    </p>
                    <pre>
                        <code class="js">
// Устанавливает повышенный приоритет свойства
span.style.setProperty("width", "10%", "important");
// Устанавливает обычный приоритет
span.style.setProperty("margin","5px 8px", "");
                        </code>
                    </pre>
                    <p>
                        Это единственный способ работы с приоритетом CSS свойств из JS. Через короткую форму записи
                        назначение свойства с приоритетом работать <u>не будет</u>:
                    </p>
                    <pre>
                        <code class="js">
span.style.caretColor = "white !important";     // Ноль результата
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Метод getPropertyPriority</h2>
                    <p>
                        Метод <span class="blue">getPropertyPriority()</span> даёт возможность проверить приоритет
                        конкретного CSS свойства.
                    </p>
                    <pre>
                        <code class="js">
let priority = style.getPropertyPriority("property-name");
                        </code>
                    </pre>
                    <p>
                        Единственным параметром принимает имя проверяемого свойства, возвращает пустую строку или
                        строку "important".
                    </p>
                    <pre>
                        <code class="js">
let img = document.images[0];
let prior = img.style.getPropertyPriority("scrollBehavior");
if (prior === "important") {
    console.log("scrollBehavior is set to important!");
}
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Метод removeProperty</h2>
                    <p>
                        Метод <span class="blue">removeProperty()</span> позволяет сбросить (обнулить) значение
                        указанного CSS свойства.
                    </p>
                    <pre>
                        <code class="js">
let oldValue = style.removeProperty("property-name");
                        </code>
                    </pre>
                    <p>
                        Параметром передаётся название обнуляемого свойства, возвращаемым значением приходит
                        значение, которое было в свойстве перед обнулением.
                    </p>
                    <pre>
                        <code class="js">
let p = document.querySelector("p");
p.style.setProperty("border-radius", "2px", "important");
console.log(p.style.borderRadius);      // "2px"
console.log(p.style.getPropertyPriority("border-radius"));  // "important"

let old = p.style.removeProperty("border-radius");  // old = "2px"
console.log(p.style.borderRadius);      // ""
console.log(p.style.getPropertyPriority("border-radius"));  // ""
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Свойство cssText</h2>
                    <p>
                        В свойстве <span class="blue">cssText</span> хранится строка, представляющая собой
                        встроенный стиль элемента. Иначе говоря, это то же, что и значение атрибута <i>style</i>.
                    </p>
                    <p>
                        Если в HTML:
                    </p>
                    <pre>
                        <code class="html">
&lt;span class="sent" style="heigth: 20px; margin: 5px 2px; color: black"&gt;Sentence - Предложение&lt;/span&gt;
                        </code>
                    </pre>
                    <p>
                        То в свойстве <span class="blue">cssText</span> у стиля этого элемента будет:
                    </p>
                    <pre>
                        <code class="js">
let sentSpan = document.querySelector("span.sent");
let inlineStyles = sentSpan.style.cssText;
console.log(inlineStyles);          // "heigth: 20px; margin: 5px 2px; color: black"
if (inlineStyles != "") {
    console.log("Element has inline styles");
}
                        </code>
                    </pre>
                </section>
            </section>
            <section>
                <section>
                    <h2>Inline стили</h3>
                    <p>
                        Свойство <span class="blue">style</span> - очень мощный инструмент, с помощью него можно создавать
                        настоящую динамику и сложную анимацию на странице.
                    </p>
                    <p>
                        Но у этого свойства есть одна проблема: оно работает чисто со <span class="purple">встроенными (inline)</span>
                        стилями.
                    </p>
                    <blockquote>
                        Inline стилями называются стили, которые прописаны прямо внутри HTML элемента.
                    </blockquote>
                    <p>
                        В документе это выглядит вот так:
                    </p>
                    <pre>
                        <code class="html">
&lt;span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;"&gt;&lt;/span&gt;
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Проблема</h2>
                    <p>
                        Если задать значение inline свойству, и затем прочитать его, всё будет нормально:
                    </p>
                    <pre>
                        <code class="js">
// HTML:  &lt;body&gt;
document.body.style.backgroundColor = "rgb(100, 100, 100)";

// Теперь HTML: &lt;body style="background-color: rgb(100, 100, 100)"&gt;
console.log(document.body.style.backgroundColor);
// Выведет "rgb(100, 100, 100)"
                        </code>
                    </pre>
                    <p>
                        А что если свойство заднего фона будет задано стилями, например, через класс?
                    </p>
                    <pre>
                        <code class="js">
// CSS:  .ct { backgroundColor: darkblue; }
// HTML:  &lt;body class="ct"&gt;

console.log(document.body.style.backgroundColor);  
// Выведет ""
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Ограничения</h2>
                    <p>
                        Свойство <span class="blue">style</span> очень удобное и незаменимое.
                    </p>
                    <p>
                        Но оно обладает весьма серьёзными ограничениями.
                    </p>
                    <p>
                        Это свойство работает только с <i>inline</i> стилями, и никак не контактирует со всеми
                        остальными формами задания CSS свойств.
                    </p>
                    <p>
                        Этим свойством style удобно пользоваться, когда нужно <u>изменить стиль</u>.
                    </p>
                    <p>
                        А вот с целью получения текущих значений CSS свойств, оно поможет слабо. Для
                        этого нужен другой подход.
                    </p>
                </section>
            </section>
            <section>
                <section>
                    <h2>Вычисленные свойства</h2>
                    <p>
                        CSSOM предоставляет глобальную функцию <span class="blue">getComputedStyle()</span>, находящуюся
                        прямо в <i>window</i>(не знаю, что она там забыла).
                    </p>
                    <p>
                        И эта функция позволяет получить 
                        <a href="http://bit.ly/2IayEFi">полную таблицу вычисленных</a> на текущий момент времени свойств
                        для любого элемента HTML страницы.
                    </p>
                    <p>
                        Через эту функцию нельзя изменять значения свойств элемента, можно только получать.
                    </p>
                </section>
                <section>
                    <h2>getComputedStyle</h2>
                    <p>
                        Эта функция, <span class="blue">getComputedStyle()</span>, принимает в качестве параметра объект
                        элемента, чьи CSS свойства нужно получить, и возвращает такой же объект, какой содержится в свойстве
                        <span class="blue">style</span>, т.е. объект с ключами для всех CSS свойств, только readonly и 
                        с вычисленными значениями. 
                    </p>
                    <pre>
                        <code class="js">
let computed = getComputedStyle(element);

let div = document.getElementsByTagName("div");
let compForDiv = getComputedStyle(div);
                        </code>
                    </pre>
                </section>
                <section>
                    <h3>Вычисленные значения</h3>
                    <p>
                        Их также можно видеть в Инструментах Разработчика на специальной панели:
                    </p>
                    <img src="img/computed.jpg">
                </section>
                <section>
                    <h2>Вычисленные значения</h2>
                    <p>
                        <span class="purple">Вычисленные значения</span> свойств отражают состояние стиля отображения элемента
                        на момент их получения. Если значение CSS свойства задаётся формулой или относительным выражением,
                        то здесь будет выдано уже рассчитанное значение, а не сама формула.
                    </p>
                </section>
                <section>
                    <h2>Примеры функционирования</h2>
                    <p>
                        Если у нас есть <i>div</i>, у которого с помощью CSS класса задан цвет фона
                        <i>background-color: rgb(10, 16, 242)</i>.
                    </p>
                    <p>
                        Тогда в вычисленных значениях для элемента можно будет получить это значение:
                    </p>
                    <pre>
                        <code class="js">
let div = document.getElementById("main");
let cmp = getComputedStyle(div);

console.log(cmp.backgroundColor);      // "rgb(10, 16, 242)"

// Ошибка - нельзя изменять вычисленные свойства
cmp.backgroundColor = "rgb(111, 147, 80)";

                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Особенности вычисленных значений</h2>
                    <p>
                        А теперь представим, что свойство <i>background-color</i> для нашего <i>div</i>-а
                        прописано следующим образом: <i>background-color: blue</i>.
                    </p>
                    <p>
                        Но в <span class="blue">getComputedStyle()</span> оно будет выглядеть уже не так, как
                        было прописано в CSS:
                    </p>
                    <pre>
                        <code class="js">
let div = document.getElementById("main");
let cmp = getComputedStyle(div);

console.log(cmp.backgroundColor);      // "rgb(0, 0, 255)"
// blue -> rgb(0, 0, 255)

                        </code>
                    </pre>
                    <p>
                        И так будет для всех остальных форм записи цвета - вернётся значение в формате rgb/rgba.
                    </p>
                </section>
                <section>
                    <h2>Вычисленные размеры</h2>
                    <p>
                        Это может стать проблемой при получении размеров:
                    </p>
                    <p>
                        Допустим, в CSS для элемента задана ширина как <i>width: 60%</i>. 
                    </p>
                    <pre>
                        <code class="js">
let div = document.getElementById("main");
let cmp = getComputedStyle(div);

console.log(cmp.width);      // 782px
// 60% -> 782px
                        </code>
                    </pre>
                    <p>
                        Любые размеры будут показаны в пикселях. Вне зависимости от их формы записи в оригинальном CSS.
                        Высота, ширина, внутренние/внешние отступы, смещение, граница - все свойства, в которых
                        фигурируют размеры, будут рассчитаны в пикселях.
                    </p>
                </section>
                <section>
                    <h2>Значения по умолчанию</h2>
                    <p>
                        А теперь попробуем заглянуть в свойство <i>backgroundColor</i> без задания цвета в CSS,
                        т.е. когда в CSS просто не прописан задний фон для элемента.
                    </p>
                    <pre>
                        <code class="js">
let div = document.getElementById("main");
let cmp = getComputedStyle(div);

console.log(cmp.backgroundColor);      // rgba(0, 0, 0, 0)
// ничего -> rgba(0, 0, 0, 0)
                        </code>
                    </pre>
                    <p>
                        Откуда взялось это значение? Это значение по умолчанию.
                    </p>
                    <p>
                        В объекте, который возвращает функция <span class="blue">getComputedStyle()</span>, все свойства
                        проинициализированы и имеют какое-то значение. Если свойство не было прописано в CSS, то для него
                        используется значение по умолчанию. 
                    </p>
                </section>
                <section>
                    <h2>Суть вычисленных свойств</h2>
                    <p>
                        Вычисленные свойства не отражают все CSS свойства и наборы стилей, привязанные к элементу. 
                        Они показывают, чему равны значения CSS свойств элемента <u>на текущий момент</u>. 
                    </p>
                    <p>
                        Например, если к элементу применяется несколько наборов стилей с перекрывающимися свойствами,
                        с помощью <span class="blue">getComputedStyle()</span> нельзя узнать о тех свойствах,
                        которые были подавлены более приоритетными селекторами.
                    </p>
                </section>
                <section>
                    <h2>Стили псевдоэлементов</h2>
                    <p>
                        С помощью функции <span class="blue">getComputedStyle()</span> также можно получать вычисленные
                        значения свойств псевдоэлементов.
                    </p>
                    <p>
                        Для этого в функцию нужно передать второй параметр - строку с типом псевдоэлемента.
                    </p>
                    <pre>
                        <code class="js">
let computed = getComputedStyle(element, pseudoType);

let cmp1 = getComputedStyle(div, "::before");
let cmp2 = getComputedStyle(div, "::placeholder");
let cmp3 = getComputedStyle(div, "::selection");
let cmp4 = getComputedStyle(div, "::first-letter");
                        </code>
                    </pre>
                    <p>
                        И это, к слову, единственный в JS способ получения значений для псевдоэлементов.
                    </p>
                </section>
                <section>
                    <h3>Пример с псевдоэлементами</h3>
                    <div class="flex">
                        <div class="c1">
                            <pre>
                                <code class="css">
.box::before {
    content: "Example";
    display: block;
    background-color: rgb(13, 239, 120);
    width: 50px;
}
.box::placeholder {
    content: "Please, enter your name";
    display: block;
    color: #A2A2A2;
    margin-left: 30px;
}
                                </code>
                            </pre>
                        </div>
                        <div class="c1">
                            <pre>
                                <code class="js">
let box = document.querySelector(".box");

let beforeStyle = window.getComputedStyle(box, "::before");
console.log(beforeStyle.width);        
// 50px  

let placeholderStyle = window.getComputedStyle(box, "::placeholder");
console.log(placeholderStyle.content);
// "Please, enter your name"

                                </code>
                            </pre>
                        </div>
                    </div>
                </section>
            </section>
            <section>
                <section>
                    <h2>Анимация движения</h2>
                    <p>
                        Есть 2 способа создания для элемента анимации движения по странице. 
                    </p>
                    <ul>
                        <li>На чистом CSS</li>
                        <li>И при помощи JS</li>
                    </ul>
                    <p>
                        CSS используется для более простой анимации, когда траекторию перемещения можно описать несколькими
                        точками и она не меняется по ходу работы программы. Простая интерактивная анимация создаётся через CSS
                        свойство <span class="blue">transition</span>, более сложная и автоматическая - через свойство
                        <span class="blue">animation</span> и ключевые кадры.
                    </p>
                    <p>
                        Через JS анимацию нужно делать только тогда, когда траектория движения элементов на странице
                        сложна, непредсказуема, или очень сильно варьируется в зависимости от действий пользователя. 
                    </p>
                </section>
                <section>
                    <h2>Позиционирование</h2>
                    <p>
                        Любая анимация реализуется через изменение CSS свойств элемента. Но в CSS нет такого понятия,
                        как координаты элемента. Но зато есть свойства для задания относительного положения на странице -
                        <span class="blue">top</span>, <span class="blue">right</span>, <span class="blue">bottom</span>
                        и <span class="blue">left</span>. Именно они используются в роли координат элемента.
                    </p>
                    <p>
                        Но эти CSS свойства доступны только для жестко позиционированных элементов. Поэтому для элементов, 
                        движение которых нужно анимировать, обычно используется абсолютная или фиксированная позиция.
                    </p>
                </section>
                <section>
                    <h2>Анимация через CSS</h2>
                    <style>
                        .cp_embed_wrapper > iframe[id="cp_embed_PgbQLR"] {
                            height: 500px;
                        }
                    </style>
                    <p class="codepen" data-height="265" data-theme-id="0" data-default-tab="css,result" data-user="ParadoxMaster" data-slug-hash="PgbQLR" data-preview="true" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CSS Animation by Transition">
                        <span>See the Pen <a href="https://codepen.io/ParadoxMaster/pen/PgbQLR/">
                        CSS Animation by Transition</a> by Pavel (<a href="https://codepen.io/ParadoxMaster">@ParadoxMaster</a>)
                        on <a href="https://codepen.io">CodePen</a>.</span>
                    </p>
                    <script async src="https://static.codepen.io/assets/embed/ei.js"></script>
                </section>
                <section>
                    <h2>Анимация через JS</h2>
                    <style>
                        .cp_embed_wrapper > iframe[id="cp_embed_bJBvaP"] {
                            height: 500px;
                        }
                    </style>
                    <p class="codepen" data-height="265" data-theme-id="0" data-default-tab="js,result" data-user="ParadoxMaster" data-slug-hash="bJBvaP" data-preview="true" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="JS Animation">
                        <span>See the Pen <a href="https://codepen.io/ParadoxMaster/pen/bJBvaP/">
                        JS Animation</a> by Pavel (<a href="https://codepen.io/ParadoxMaster">@ParadoxMaster</a>)
                        on <a href="https://codepen.io">CodePen</a>.</span>
                    </p>
                    <script async src="https://static.codepen.io/assets/embed/ei.js"></script>
                </section>
            </section>
            <section>
                <section>
                    <h1>Таблицы стилей CSS</h1>
                    <p>
                        <span class="purple">CSSOM</span> даёт возможности программно работать не только с CSS свойствами
                        конкретных HTML элементов, но и предоставляет функционал для чтения и записи в любые таблицы/наборы
                        стилей.
                    </p>
                    <p>
                        Под <span class="purple">таблицами стилей</span> (<span class="blue">Stylesheets</span>) 
                        подразумеваются CSS файлы с набором прописанных стилей с селекторами, а также встроенные в HTML
                        теги <i>style</i>.
                    </p>
                </section>
                <section>
                    <h2>Список таблиц стилей</h2>
                    <p>
                        Самый простой способ программного доступа к таблицам стилей - через свойство
                        <span class="blue">document.styleSheets</span>.
                    </p>
                    <blockquote>
                        Свойство <span class="blue">document.styleSheets</span> содержит массив (не стандартный 
                        <i>Array</i>) из всех подключенных к текущему документу наборов стилей.
                    </blockquote>
                    <p>
                        Каждый отдельный CSS файл, подключенный тегом <i>link</i>, считается набором стилей.
                    </p>
                    <p>
                        Каждый тег <i>style</i> внутри HTML документа также считается самостоятельным набором стилей.
                    </p>
                </section>
                <section>
                    <h2>document.styleSheets</h2>
                    <p>
                        Этот объект имеет стандартное свойство <span class="blue">length</span>, а к отдельным его
                        элементам можно обращаться по индексу.
                    </p>
                    <pre>
                        <code class="js">
document.styleSheets
                        </code>
                    </pre>
                    <p>
                        Например:
                    </p>
                    <pre>
                        <code class="js">
console.log("Количество таблиц стилей подключенных к документу:");
console.log(document.styleSheets.length);

console.log("Список таблиц стилей:");
for (let i = 0; i < document.styleSheets.length; ++i) {

    console.log(`${i}-ая таблица стилей:`);
    console.log(document.styleSheets[i]);
}
                        </code>
                    </pre>
                </section>
                <section>
                    <h3>Список таблиц стилей</h3>
                    <pre>
                        <code class="js">
console.log(document.styleSheets);
                        </code>
                    </pre>
                    <p>
                        На выводе это может выглядеть как-нибудь так:
                    </p>
                    <img src="img/stylesheets.jpg">
                </section>
                <section>
                    <h2>Объект CSSStyleSheet</h2>
                    <p>
                        Элементы этого массива являются объектами <span class="blue">CSSStyleSheet</span>,
                        каждый из которых выглядит следующим образом:
                    </p>
                    <pre>
                        <code class="js">
console.log(document.styleSheets[2]);
                        </code>
                    </pre>
                    <img src="img/one_stylesheet.jpg">
                </section>
                <section>
                    <h2>Свойства CSSStyleSheet</h2>
                    <p>
                        Основные свойства, которые содержит объект <span class="blue">CSSStyleSheet</span>:
                    </p>
                    <ul>
                        <li><span class="blue">disabled</span> - отключена ли таблица стилей</li>
                        <li><span class="blue">href</span> - адрес CSS файла, если он есть</li>
                        <li><span class="blue">media</span> - список медиа, для которых будет применяться набор стилей
                            (атрибут <i>media</i> в <i>link</i>)</li>
                        <li><span class="blue">ownerNode</span> - HTML элемент, через который таблица стилей подключена</li>
                        <li><span class="blue">title</span> - подпись для таблицы стилей (атрибут <i>title</i> в <i>link</i>)</li>
                        <li><b><span class="blue">cssRules</span>/<span class="blue">rules</span></b> - 
                            перечисление всех CSS правил</li>
                    </ul>
                    <p>
                        Все свойства, кроме <span class="blue">disabled</span> и <span class="blue">cssRules</span>,
                        являются <i>readonly</i>, только для чтения.
                    </p>
                </section>
                <section>
                    <h3>Пример со свойством disabled</h3>
                    <p>
                        Ниже представлена функция, с помощью которой можно включать/выключать любые таблицы стилей на странице:
                    </p>
                    <pre>
                        <code class="js">
function cssEditor() {

    let panel = document.createElement("div");
    panel.innerHTML = `&lt;div id="pan1" style="background: rgb(200,200,200); width: 25%; height: auto; border: 1px solid black;
                        display: flex; flex-flow: column nowrap; position: fixed; bottom: 20px; right: 20px;"&gt;&lt;/div&gt;`;
    document.body.appendChild(panel);
    panel = panel.firstElementChild;

    function appendItem(stylesheet) {

        let newItem = document.createElement("div");
        newItem.style.background = "white";
        newItem.style.margin = "3px 6px";
        newItem.style.width = "calc(100% - 12px)";
        newItem.style.height = "20px";
        newItem.style.cursor = "pointer";
        newItem.style.display = "flex";
        newItem.style.flexFlow = "row nowrap";
        let indicator = document.createElement("span");
        indicator.style.width = "20px";
        indicator.style.height = "20px";
        indicator.style.marginRight = "30px";
        indicator.style.borderRadius = "50%";
        indicator.style.border = "1px solid black";
        newItem.appendChild(indicator);
        let text = document.createElement("span");
        text.style.height = "20px";
        text.style.lineHeight = "20px";
        text.innerHTML = stylesheet.href != null ? stylesheet.href : "inline";
        newItem.appendChild(text);
        panel.appendChild(newItem);

        let updateColorStatus = function() {
            
            if (stylesheet.disabled) {
                indicator.style.background = "red";
            } else {
                indicator.style.background = "green";
            }
        }
        updateColorStatus();
        newItem.addEventListener("click", function() {

            stylesheet.disabled = !stylesheet.disabled;
            updateColorStatus();

        });
    }
    for (let i = 0; i < document.styleSheets.length; ++i) {
        appendItem(document.styleSheets[i]);
    }

}
cssEditor();
                        </code>
                    </pre>
                </section>
            </section>
            <section>
                <section>
                    <h2>Свойство cssRules</h2>
                    <p>
                        Но самое интересное в объекте <span class="blue">CSSStyleSheet</span> - это свойство
                        <span class="blue">cssRules</span>.
                    </p>
                    <p>
                        Свойство <span class="blue">cssRules</span> хранит в себе перечисление всех CSS правил,
                        описанных в соответствующей таблице стилей, включая обычные блоки с селекторами, @-блоки,
                        медиа-выражения, блоки кадров анимации и т.д. - всё, что бывает в CSS файлах.
                    </p>
                </section>
                <section>
                    <h2>CssRules</h2>
                    <p>
                        Свойство <span class="blue">cssRules</span> хранит коллекцию объектов <span class="blue">CSSStyleRule</span>,
                        которые представляют собой конкретные блоки CSS правил.
                    </p>
                    <img src="img/cssrules.jpg">
                </section>
                <section>
                    <h2>Объект CSSStyleRule</h2>
                    <p>
                        Объект <span class="blue">CSSStyleRule</span> предназначен для описания отдельного CSS правила,
                        из которых состоят таблицы стилей.
                    </p>
                    <img src="img/cssrule.jpg">
                </section>
                <section>
                    <h2>Свойства объекта CSSStyleRule</h2>
                    <p>
                        Основные свойства объекта <span class="blue">CSSStyleRule</span>:
                    </p>
                    <ul>
                        <li><span class="blue">type</span> - тип CSS правила</li>
                        <li><span class="blue">cssText</span> - текст CSS правила</li>
                        <li><span class="blue">selectorText</span> - текст селектора</li>
                        <li><span class="blue">style</span> - объект со свойствами CSS</li>
                        <li><span class="blue">styleMap</span> - другой объект со свойствами CSS</li>
                    </ul>
                </section>
                <section>
                    <h2>Типы CSS правил</h2>
                    <p>
                        В свойстве <span class="blue">type</span> записано число, которое показывает к какому типу
                        CSS блоков относится текущее правило. Всего есть 16 типов CSS правил, среди основных:
                    </p>
                    <table>
                        <tr>
                            <th>Код</th>
                            <th>Константа</th>
                            <th>Описание</th>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>CSSRule.STYLE_RULE</td>
                            <td>Стандартный набор CSS свойств с селектором</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>CSSRule.IMPORT_RULE</td>
                            <td>Элемент @import</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>CSSRule.MEDIA_RULE</td>
                            <td>Медиа-выражение</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>CSSRule.FONT_FACE_RULE</td>
                            <td>Блок шрифта</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>CSSRule.PAGE_RULE</td>
                            <td>Правило @page для печати</td>
                        </tr>
                        <tr>
                            <td>7</td>
                            <td>CSSRule.KEYFRAMES_RULE</td>
                            <td>Кадры анимации</td>
                        </tr>
                    </table>
                </section>
                <section>
                    <h3>Пример с type</h3>
                    <p>
                        Следующая функция будет искать все медиа-выражения во всех подключенных к документу таблицах стилей:
                    </p>
                    <pre>
                        <code class="js">
function showAllMediaQuery() {

    let count = 0;
    let i = 0;
    try {
        for (i = 0; i < document.styleSheets.length; ++i) {

            let stylesheet = document.styleSheets[i];
            for (let j = 0; j < stylesheet.cssRules.length; ++j) {

                let rule = stylesheet.cssRules[j];
                if (rule.type === CSSRule.MEDIA_RULE) {
                    console.log(rule);
                    count++;
                }
            }
        }
        console.log(`На этой странице ${count} медиа-выражений`);

    } catch(exc) {
        console.log("Что-то пошло не так...");
    }
}
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Текстовые свойства</h2>
                    <p>
                        Свойство <span class="blue">cssText</span> содержит в себе текстовую запись всего блок CSS правила,
                        как оно прописано в CSS файле/теге style. Например:
                    </p>
                    <pre>
                        <code class="js">
let randomRule = document.styleSheets[3].cssRules[8];
console.log(randomRule.cssText);
// ".pupil > div { width: 25px; margin: 3px 6px; color: black; }"
                        </code>
                    </pre>
                    <p>
                        Свойство <span class="blue">selectorText</span> содержит только текст селектора для указанного
                        CSS правила. Например:
                    </p>
                    <pre>
                        <code class="js">
console.log(randomRule.selectorText);
/* ".pupil > div"
*/ 
                        </code>
                    </pre>
                </section>
                <section>
                    <h3>Пример с cssSelector</h3>
                    <p>
                        Например, вот здесь выводятся все CSS селекторы, которые встречаются в документе:
                    </p>
                    <style>
                        .cp_embed_wrapper > iframe[id="cp_embed_zXoRpO"] {
                            height: 400px;
                        }
                    </style>
                    <p class="codepen" data-height="265" data-theme-id="0" data-default-tab="css,result" data-user="ParadoxMaster" data-slug-hash="zXoRpO" data-preview="true" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="Work with CSSStyleSheet – Logging selectors">
                        <span>See the Pen <a href="https://codepen.io/ParadoxMaster/pen/zXoRpO/">
                        Work with CSSStyleSheet – Logging selectors</a> by Pavel (<a href="https://codepen.io/ParadoxMaster">@ParadoxMaster</a>)
                        on <a href="https://codepen.io">CodePen</a>.</span>
                    </p>
                    <script async src="https://static.codepen.io/assets/embed/ei.js"></script>
                </section>
                <section>
                    <h2>Изменение селектора</h2>
                    <p>
                        Свойство <span class="blue">selectorText</span> является редактируемым, а это значит,что с его
                        помощью можно менять селектор CSS правила.
                    </p>
                    <pre>
                        <code class="js">
if (i.selectorText === 'a:hover') {

    i.selectorText = 'a:hover, a:active';

}
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Свойство style у CSS правила</h2>
                    <p>
                        И вот мы снова пришли к объекту <span class="blue">CSSStyleDeclaration</span>, который использовался
                        во встроенных и вычисленных стилях. 
                    </p>
                    <p>
                        В объекте <span class="blue">CSSStyleRule</span> свойство <span class="blue">style</span> хранит
                        свойства, назначенные выбранному CSS правилу.
                    </p>
                    <p>
                        С помощью этого свойства удобнее всего редактировать CSS правила. Удаление/добавление/изменение
                        свойств в этом объекте будет отображаться в изменения CSS правила.
                    </p>
                </section>
                <section>
                    <h2>Изменение css правил</h2>
                    <p>
                        Используя свойство <span class="blue">style</span> можно изменять свойства CSS правила так же, как
                        и при работе с обычными <i>inline</i> стилями. 
                    </p>
                    <p>
                        Т.е. вот эта запись добавит в CSS правило с селектором на класс <i>list-item</i> стиль для
                        отображения чёрной рамки:
                    </p>
                    <pre>
                        <code class="js">
let target = "#wikiArticle > p:nth-child(19) > em";
let rule = null;
for (let i in document.styleSheets) {
    
    let end = false;
    for (let j in document.styleSheets[i]) {

        if (document.styleSheets[i].selectorText == target) {
            rule = document.styleSheets[i];
            end = true;
            break;
        }
    }
    if (end) break;
}
if (rule) {
    // Меняем свойства в CSS правиле
    rule.style.border = "1px solid black";
}
                        </code>
                    </pre>
                </section>
                <section>
                    <h3>Поиск применяющихся CSS правил</h3>
                    <p>
                        В Js нет встроенной функции, которая выдавала бы набор CSS правил, применяющихся к элементу. Но
                        такую функцию можно написать самостоятельно:
                    </p>
                    <pre>
                        <code class="js">
function getRulesFor(el) {
    let sheets = document.styleSheets;
    let ret = [];
    for (let i = 0; i < sheets.length; ++i) {

        let rules = sheets[i].cssRules;
        for (let j = 0; j < rules.length; ++j) {

            // Проверяем, подходит ли заданный элемент под указанный селектор
            if (el.matches(rules[j].selectorText)) {
                // Если подходит, то добавляем CSS правило в массив
                ret.push(rules[j]);
            }
        }
    }
    return ret;
}
                        </code>
                    </pre>
                </section>
                <section>
                    <h3>Использование этой функции</h3>
                    <div class="flex">
                        <div class="c1">
                           <img src="img/rules_for_element.jpg">
                        </div>
                        <div class="c1">
                            <img src="img/rules_for_element_2.jpg">
                        </div>
                    </div>
                </section>
            </section>
            <section>
                <section>
                    <h2>Создание новых CSS правил</h2>
                    <p>
                        Создавать новые CSS правила можно с помощью метода <span class="blue">insertRule()</span> 
                        объекта <span class="blue">CSSStyleSheet</span>.
                    </p>
                    <p>
                        А удалять существующие CSS правила с помощью метода <span class="blue">deleteRule()</span>.
                    </p>
                    <p>
                        При добавлении элемента нужно указывать индекс, по которому новое правило будет вставлено в 
                        таблицу стилей. И удаление происходит именно по индексу.
                    </p>
                    <pre>
                        <code class="js">
let cssFile = document.styleSheets[0];
cssFile.insertRule("#blanc { color: white }", 0);

cssFile.deleteRule(0);
                        </code>
                    </pre>
                </section>
                <section>
                    <h3>Примеры добавления правил</h3>
                    <pre>
                        <code class="js">
let myStylesheet = document.styleSheets[0];
console.log(myStylesheet.cssRules.length); // 8

let newRule = "article { line-height: 1.5; font-size: 1.5em; }";
// Добавление в конец
document.styleSheets[0].insertRule(newRule, myStylesheet.cssRules.length);
console.log(document.styleSheets[0].cssRules.length); // 9

myStylesheet.deleteRule(3);
console.log(myStylesheet.cssRules.length); // 7
                        </code>
                    </pre>
                </section>
            </section>
            <section>
                <section>
                    <h2>Как итог</h2>
                    <p>
                        <i>CSSOM</i> API состоит из 3 основных частей. Это:
                    </p>
                    <ul>
                        <li><span class="blue">element.style</span> - свойство для работы с <i>inline</i> свойствами</li>
                        <li><span class="blue">getComputedStyle()</span> - метод для получения фактических значений свойств</li>
                        <li><span class="blue">styleSheets и cssRules</span> - объекты для работы со сформированными CSS правилами</li>
                    </ul>
                </section>
                <section>
                    <h2>Встроенные свойства</h2>
                    <p>
                        <span class="purple">Встроенные свойства</span> нужно использовать когда требуется программно
                        динамически менять CSS свойства элементов на странице.
                    </p>
                </section>
                <section>
                    <h2>Вычисленные значения</h2>
                    <p>
                        <span class="purple">Вычисленные значения</span> свойств нужны тогда, когда необходимо в логике
                        скрипта отталкиваться от присутствующих стилей документа, например, чтобы узнать положение
                        элемента на странице, получить его размеры, цвет и т.д.
                    </p>
                </section>
                <section>
                    <h2>Таблицы стилей и CSS правила</h2>
                    <p>
                        Это более продвинутый механизм, который используется в основном в сложных веб приложениях,
                        когда за счёт действий пользователя должны создаваться новые стили.
                    </p>
                    <p>
                        Например, это может применяться в браузерных векторных графических редакторах, 
                        или веб-приложениях для создания сайтов.
                    </p>
                </section>
            </section>
		</div>
	</div>

	<aside id="presentable-icon" class="cpp">
		<a title="Содержание лекции" href="#/0/1">
			<i class="fa fa-list-ul fa-2x controls"></i>
		</a>
	</aside>
	<aside id="presentable-icon-close">
		<a title="К списку материалов" href="../../index.html#/1">
			<i class="fa fa-times fa-2x controls"></i>
		</a>
	</aside>
	<aside id="presentable-theme-picker">
		<div id="hidden-bar" class="invisible">
			<div>
				<div data-theme="beige" class="theme-circle theme-beige"></div>
				<div data-theme="black" class="theme-circle theme-black"></div>
				<div data-theme="blood" class="theme-circle theme-blood"></div>
				<div data-theme="league" class="theme-circle theme-league"></div>
				<div data-theme="moon" class="theme-circle theme-moon"></div>
				<div data-theme="night" class="theme-circle theme-night"></div>
				<div data-theme="serif" class="theme-circle theme-serif"></div>
				<div data-theme="simple" class="theme-circle theme-simple"></div>
				<div data-theme="sky" class="theme-circle theme-sky"></div>
				<div data-theme="solarized" class="theme-circle theme-solarized"></div>
				<div data-theme="white" class="theme-circle theme-white"></div>
			</div>
		</div>
		<div id="selected-theme" class="theme-circle"></div>
	</aside>

	<script src="../../js/bundle.min.js"></script>
</body>

</html>